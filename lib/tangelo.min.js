window.tangelo={};(function(t){"use strict";t.version=function(){return"0.6.1dev"};t.error=function(e,n,i){var o={};o.code=e;if(!n||t.isObject(n)){if(!i){i=n}n=t.error.string(e)}o.message=n;if(i){o.jqxhr=i}return o};t.error.message=[];t.error.string=function(e){return t.error.message[e]||"unrecognized error, code "+e};t.error.AJAX_FAILURE=0;t.error.APPLICATION_ERROR=1;t.error.message[t.error.AJAX_FAILURE]="ajax failure";t.error.message[t.error.APPLICATION_ERROR]="application error";t.fatalError=function(t,e){if(e===undefined){e=t;throw new Error(e)}throw new Error("["+t+"] "+e)};t.unavailable=function(e){var n=e.plugin,i=e.required,o,r;if(Object.prototype.toString.call(i)==="[object Array]"){if(i.length===1){i=i[0]}else if(i.length===2){i=i[0]+" and "+i[1]}else{r="";for(o=0;o<i.length-1;o+=1){r+=i[o]+", "}r+="and "+i[i.length-1];i=r}}return function(){t.fatalError("JavaScript include error: "+n+" requires "+i)}};t.requireCompatibleVersion=function(e){var n,i,o,r;r=function(t){var e,n,i,o,r;e=t.split("-");if(e.length>1){n=e.slice(0,-1).join("-");i=e.slice(-1)[0]}else{n=e[0];i=e[1]}if(!n){return null}if(i!==undefined&&(i.length===0||i.indexOf(" ")!==-1)){return null}n=n.split(".").map(function(t){return+t});if(n.length===0){return null}for(o=0;o<n.length;o+=1){if(isNaN(n[o])||n[o]<0){return null}}r=n[0]===0?2:3;if(n.length>r){return null}for(o=n.length;o<r;o+=1){n[o]=0}return{version:n,tag:i}};n=r(e);i=r(t.version());if(!i){t.fatalError("tangelo.requireCompatibleVersion()","tangelo version number is invalid: "+t.version())}else if(!n){t.fatalError("tangelo.requireCompatibleVersion()","invalid version string: "+e)}if(n.tag||i.tag||n.version[0]===0||i.version[0]===0){o=n.tag===i.tag&&n.version[0]===i.version[0]&&n.version[1]===i.version[1]&&n.version[2]===i.version[2]}else{o=n.version[0]===i.version[0]&&(n.version[1]<i.version[1]||n.version[1]===i.version[1]&&n.version[2]<=i.version[2])}return o}})(window.tangelo);(function(t,e){"use strict";if(!e){t.config=t.unavailable({plugin:"tangelo.config",required:"JQuery"})}else{t.config=function(n,i){var o=window.location.pathname;if(o.slice(-1)!=="/"){o=window.location.pathname.split("/").slice(0,-1).join("/")}if(n.length>0){if(n[0]!=="/"&&n[0]!=="~"){n=o+"/"+n}}e.ajax({url:"/service/config",data:{path:n},dataType:"json",error:function(t){i(undefined,undefined,t)},success:function(e){if(e.error){i(undefined,undefined,t.error(t.error.APPLICATION_ERROR,e.error))}else{i(e.result,e.status)}}})}}t.uniqueID=function(){var t={"":true},e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";return function(n){var i="",o;n=n||6;while(t.hasOwnProperty(i)){i="";for(o=0;o<n;o+=1){i+=e[Math.floor(Math.random()*52)]}}t[i]=true;return i}}();t.queryArguments=function(){var t={},e,n,i;if(window.location.search.length>1){for(n=0,i=window.location.search.substr(1).split("&");n<i.length;n+=1){e=i[n].split("=");t[decodeURI(e[0])]=e.length>1?decodeURI(e[1]):""}}return t};t.isNumber=function(t){return typeof t==="number"};t.isBoolean=function(t){return typeof t==="boolean"};t.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"};t.isObject=function(t){return Object.prototype.toString.call(t)==="[object Object]"};t.isString=function(t){return Object.prototype.toString.call(t)==="[object String]"};t.isFunction=function(t){return Object.prototype.toString.call(t)==="[object Function]"};t.absoluteUrl=function(t){var e,n;if(t.length===0||t[0]==="/"||t[0]==="~"){return t}e=window.location.pathname[window.location.pathname.length-1]==="/";n=window.location.pathname;if(!e){n=window.location.pathname.split("/").slice(0,-1).join("/")+"/"}return n+t};t.accessor=function(e){var n,i;Function.prototype.clone=function(){var t=this,e,n;if(this.__isClone){t=this.__clonedFrom}e=function(){return t.apply(this,arguments)};for(n in this){if(this.hasOwnProperty(n)){e[n]=this[n]}}e.__isClone=true;e.__clonedFrom=t;return e};if(e===undefined||t.isObject(e)&&Object.keys(e).length===0){i=function(){t.fatalError("tangelo.accessor()","I am an undefined accessor - you shouldn't be calling me!")};i.undefined=true}else if(t.isFunction(e)){i=e.clone()}else if(e.hasOwnProperty("value")){i=function(){return e.value}}else if(e.hasOwnProperty("index")){i=function(t,e){return e}}else if(e.hasOwnProperty("field")){if(e.field==="."){i=function(t){return t}}else{n=e.field.split(".");i=function(t){var e;for(e=0;e<n.length;e+=1){t=t[n[e]];if(t===undefined){return undefined}}return t}}}else{t.fatalError("tangelo.accessor()","unknown accessor spec "+e)}i.accessor=true;return i}})(window.tangelo,window.jQuery);(function(t,e){"use strict";var n=t.unavailable({plugin:"tangelo.widget",required:["JQuery","JQuery UI"]});if(!e){t.widget=n}else if(!e.widget){t.widget=e.fn.widget=n}else{e.widget("tangelo.widget",{_setOption:function(e,n){if(this._defaults[e]&&this._defaults[e].accessor){this._super(e,t.accessor(n))}else{this._super(e,n)}},_setOptions:function(t){var n=this;e.each(t,function(t,e){n._setOption(t,e)});this._update()},_update:e.noop});t.widget=function(n,i,o){var r,a,s,l;if(i.prototype instanceof e.tangelo.widget){s=o;l=i}else{s=i;l=e.tangelo.widget}a={_defaults:s.options||{},_create:function(){this.options=e.extend({},this._defaults,this.options);if(s._create){s._create.apply(this,arguments)}this._setOptions(this.options)}};for(r in s){if(s.hasOwnProperty(r)){if(r==="_defaults"){t.fatalError('tangelo.widget("'+n+'")',"You cannot use '_defaults' as a field name in your Tangelo widget")}else if(r!=="_create"){a[r]=s[r]}}}e.widget(n,l,a)}}})(window.tangelo,window.jQuery);window.tangelo.vegaspec={};(function(t){"use strict";t.vegaspec.geovis=function(t){var e={width:800,height:800,data:[{name:"countries",url:null,format:{type:"topojson",feature:"countries"}},{name:"links",transform:[{type:"copy",from:"data",fields:["source","target"]}]},{name:"filter"},{name:"table",transform:[{type:"force",links:"links",iterations:0},{type:"geo",lat:"data.latitude",lon:"data.longitude",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]}],scales:[{name:"color",type:"ordinal",range:"category10"},{name:"size",type:"linear",range:[100,400],zero:false,domain:{data:"table",field:"data.size"}}],legends:[{fill:"color",orient:"left",properties:{labels:{fontSize:{value:18}},symbols:{size:{value:100},stroke:{value:"#fff"}}}}],marks:[{type:"path",from:{data:"countries",transform:[{type:"geopath",value:"data",projection:"azimuthalEqualArea",clipAngle:179.99,scale:200,translate:[400,400],precision:.1}]},properties:{enter:{stroke:{value:"#fff"},path:{field:"path"}},update:{fill:{value:"#ccc"}}}},{type:"path",from:{data:"links",transform:[{type:"link",shape:"curve"}]},properties:{update:{path:{field:"path"},stroke:{value:"black"},strokeOpacity:{value:1},strokeWidth:{value:1}}}},{type:"symbol",from:{data:"table"},properties:{enter:{x:{field:"x"},y:{field:"y"}},update:{stroke:{value:"#fff"},fill:{scale:"color",field:"data.color"},size:{scale:"size",field:"data.size"}}}}]};e.data[0].url=t;return e}})(window.tangelo);window.tangelo.vtkweb={};(function(t,e,n){"use strict";t.vtkweb.processes=function(n){e.ajax({url:"/vtkweb",dataType:"json",error:function(t){n(undefined,t)},success:function(e){if(e.error){t.fatalError("tangelo.vtkweb.processes()",e.error)}n(e)}})};t.vtkweb.info=function(t,n){e.ajax({url:"/vtkweb/"+t,dataType:"json",error:function(t){n(undefined,t)},success:function(t){n(t)}})};(function(){var i={};t.vtkweb.launch=function(o){var r,a=t.absoluteUrl(o.url),s=o.callback,l=o.argstring,c=o.timeout,u=o.viewport;if(c!==undefined){console.warn("[tangelo.vtkweb.launch] warning: timeout argument has no effect")}if(a===undefined){t.fatalError("tangelo.vtkweb.launch()","argument 'url' required")}if(u===undefined){t.fatalError("tangelo.vtkweb.launch()","argument 'viewport' required")}r={program:a};if(l){r.args=l}e.ajax({url:"/vtkweb",type:"POST",data:r,dataType:"json",error:function(t){s(undefined,t)},success:function(o){var r,a;if(o.status==="failed"||o.status==="incomplete"){s(undefined,t.error(t.error.APPLICATION_ERROR,o.reason))}else if(o.status==="complete"){r={sessionURL:o.url};n.connect(r,function(t){a=n.createViewport({session:t.session});a.bind(u);e(window).resize(function(){if(a){a.render()}});a.render();i[o.key]={element:e(u).get(0),viewport:a}},function(e,n){t.fatalError("could not connect to VTKWeb server [code "+e+"]: "+n)});s(o.key)}else{t.fatalError("tangelo.vtkweb.launch()","unexpected report status '"+o.status+"'")}}})};t.vtkweb.terminate=function(n,o){e.ajax({url:"/vtkweb/"+n,type:"DELETE",dataType:"json",error:function(t){if(o){o(undefined,undefined,t)}},success:function(r){var a;if(!r.reason){i[n].viewport.unbind();a=i[n].element;delete i[n]}if(o){o(n,a,t.error(t.error.APPLICATION_ERROR,r.reason))}else if(a){e(a).empty()}}})}})()})(window.tangelo,window.jQuery,window.vtkWeb);(function(t,e,n){"use strict";if(!(e&&n)){t.unavailable({plugin:"controlPanel",required:["JQuery","d3"]});return}function i(i,o){var r,a,s,l;r=n.select(i);a=n.select(o);s="uncollapsed";l="20px";function c(){var t=r.style("height"),n;r.style("height",null);n=e(r.node()).height()+"px";r.style("height",t);return n}return function(){if(s==="uncollapsed"){r.transition().duration(500).style("height",l);a.classed("glyphicon-chevron-down",false).classed("glyphicon-chevron-up",true);s="collapsed"}else if(s==="collapsed"){r.transition().duration(500).style("height",c()).each("end",function(){r.style("height",null)});a.classed("glyphicon-chevron-down",true).classed("glyphicon-chevron-up",false);s="uncollapsed"}else{t.fatalError("drawerToggle()","illegal state: "+s)}}}e.fn.controlPanel=function(){var e,o,r,a;o=n.select(this[0]);if(o.empty()){return}a=t.uniqueID();r=o.attr("id");if(!r){r="tangelo-control-panel-"+a;o.attr("id",r)}o.style("position","fixed").style("bottom","0px").style("width","100%").insert("div",":first-child").attr("id","tangelo-drawer-handle-"+a).style("text-align","center").style("cursor","pointer").on("mouseenter",function(){n.select(this).style("background","gray")}).on("mouseleave",function(){n.select(this).style("background",null)}).append("span").attr("id","tangelo-drawer-icon-"+a).classed("glyphicon",true).classed("glyphicon-chevron-down",true);e=i("#"+r,"#tangelo-drawer-icon-"+a);n.select("#tangelo-drawer-handle-"+a).on("click",e)}})(window.tangelo,window.jQuery,window.d3);(function(t,e,n,i){"use strict";if(!(e&&n&&i)){t.GoogleMapSVG=t.unavailable({plugin:"GoogleMapSVG",required:["JQuery","Google Maps API","d3"]});return}t.GoogleMapSVG=function(o,r,a,s){var l;this.id="gmsvg-"+t.uniqueID();this.mapdiv=i.select(o).append("div").attr("id",this.id).style("width",e(o).width()+"px").style("height",e(o).height()+"px").node();this.map=new n.maps.Map(this.mapdiv,r);this.setMap(this.map);this.size={width:e(this.mapdiv).width(),height:e(this.mapdiv).height()};l=this;e(this.mapdiv).resize(function(){n.maps.event.trigger(this.map,"resize")});this.cfg=a||{};if(s){n.maps.event.addListenerOnce(this.map,"idle",function(){s(l)})}};t.GoogleMapSVG.prototype=new n.maps.OverlayView;t.GoogleMapSVG.prototype.getSVG=function(){return this.svg.node()};t.GoogleMapSVG.prototype.getMap=function(){return this.map};t.GoogleMapSVG.prototype.computeCBArgs=function(){var t,e,n;t=i.selectAll("#"+this.id+" [style~='cursor:']");n=t.style("transform")||t.style("-webkit-transform")||t.style("-o-transform")||t.style("-moz-transform");if(!n||n==="none"){n="matrix(1, 0, 0, 1, "+t.style("left").slice(0,-2)+", "+t.style("top").slice(0,-2)+")"}e=n.split(" ").map(function(t,e){var n;if(e===0){n=t.slice("matrix(".length,-1)}else{n=t.slice(0,-1)}return n});return{svg:this.svg.node(),projection:this.getProjection(),zoom:this.map.getZoom(),translation:{x:e[4],y:e[5]},transform:e,zooming:e[0]!=="1"||e[3]!=="1"}};t.GoogleMapSVG.prototype.attachListener=function(i,o,r){var a=this,s;if(Object.prototype.toString.call(i)==="[object Array]"){e.each(i,function(t,e){a.attachListener(e,o,r)});return}if(r==="once"){s=n.maps.event.addListenerOnce}else if(r==="always"){s=n.maps.event.addListener}else{t.fatalError("GoogleMapSVG.attachListener()","illegal value for argument 'how'")}s(this.map,i,function(){var t=a.computeCBArgs();if(i==="draw"){if(t.zooming){window.setTimeout(n.maps.event.trigger,100,a.map,"draw")}}o.call(a,t)})};t.GoogleMapSVG.prototype.on=function(t,e){this.attachListener(t,e,"always")};t.GoogleMapSVG.prototype.onceOn=function(t,e){this.attachListener(t,e,"once")};t.GoogleMapSVG.prototype.trigger=function(t){n.maps.event.trigger(this.map,t)};t.GoogleMapSVG.prototype.shift=function(t,e,n){i.select(t).style("-webkit-transform","translate("+e+"px, "+n+"px)").style("-moz-transform","translate("+e+"px, "+n+"px)").style("-o-transform","translate("+e+"px, "+n+"px)").style("transform","translate("+e+"px, "+n+"px)")};t.GoogleMapSVG.prototype.onAdd=function(){this.svg=i.select(this.getPanes().overlayMouseTarget).append("svg").attr("width",this.size.width).attr("height",this.size.height);if(this.cfg.initialize){this.cfg.initialize.call(this,this.svg.node(),this.getProjection(),this.map.getZoom())}};t.GoogleMapSVG.prototype.draw=e.noop})(window.tangelo,window.jQuery,window.google,window.d3);(function(t,e){"use strict";if(!(t&&e)){return}t.fn.svgColorLegend=function(n){var i,o,r,a,s,l,c,u,d,p,f,h,g,v,y,w,m,x,b,_,k,j,z,S;w=n.cmap_func;m=n.xoffset;x=n.yoffset;b=n.categories;_=n.height_padding;k=n.width_padding;j=n.text_spacing;z=n.legend_margins;S=n.clear;y=e.select(this[0]);S=S||false;if(S){y.selectAll("*").remove()}u=0;c=0;o=y.append("rect").style("fill","white").style("opacity",.7);t.each(b,function(t,e){y.append("rect").classed("colorbox",true).attr("x",m).style("fill",w(e));p=y.append("text").classed("legendtext",true).text(e);i=p[0][0].getBBox();if(i.width>u){u=i.width}if(i.height>c){c=i.height}});a=c+_;v=a;h=a*b.length;g=v+k+u;l=z.left||0;f=z.top||0;d=z.right||0;r=z.bottom||0;o.attr("x",m-l||0).attr("y",x-f||0).attr("width",l+g+d).attr("height",f+h+r);s=function(t,e){return x+e*a};y.selectAll(".colorbox").attr("width",a).attr("height",a).attr("y",s);y.selectAll(".legendtext").attr("x",m+v+k).attr("y",function(t,e){return j+s(t,e)})}})(window.jQuery,window.d3);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){return}if(!n.selection.prototype.moveToFront){n.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}}var i=0,o=function(t){t.collapse=!t.collapse},r=function(t){if(!t.collapse){return t._children}return[]},a=function(t){if(!t._treeID){i+=1;t._treeID=i}return t._treeID};function s(t){if(!t.parent||!t._treeNew){return t}return s(t.parent)}function l(t){if(!t.parent||!t._treeOld){return t}return l(t.parent)}t.widget("tangelo.dendrogram",{options:{label:t.accessor({value:""}),id:a,margin:{top:35,right:25,bottom:25,left:25},width:null,height:null,duration:750,data:{},nodeColor:t.accessor({value:"lightsteelblue"}),labelSize:t.accessor({value:"14px"}),lineWidth:t.accessor({value:1}),lineColor:t.accessor({value:"black"}),lineStyle:"curved",nodeSize:t.accessor({value:5}),on:{click:function(){return true}},expanded:function(t){return!t.collapse},labelPosition:t.accessor({value:"above"}),orientation:"vertical"},walk:function(t,e,n){var i,o=this;e=e||this.options.data;t(e);i=n?e._children:e.children;i.forEach(function(e){if(e){o.walk(t,e,n)}})},_create:function(){this.svg=n.select(this.element.get(0)).append("svg");this.group=this.svg.append("g");this._update()},_destroy:function(){this.svg.remove()},_transition:function(t){if(this.options.duration){t=t.transition().duration(this.options.duration)}return t},resize:function(){var t=this.options.duration;this.options.duration=null;this._update();this.options.duration=t},_update:function(){var e=this,i,a,c,u,d=n.layout.tree(),p,f=t.accessor(this.options.id),h,g,v,y,w=this.options.orientation==="vertical",m="",x,b,_=this.options.margin.left,k=this.options.margin.top,j=this.options.margin.right,z=this.options.margin.bottom;i=this.options.width||this.element.width();a=this.options.height||this.element.height();c=i;u=a;if(!w){b=a-z;x=i;i=a;a=x;m="translate("+_+","+b+") "+"rotate(-90) ";k=this.options.margin.right;z=this.options.margin.left;_=this.options.margin.top;j=this.options.margin.bottom}else{m="translate("+_+","+k+")"}this.svg.attr("width",c).attr("height",u);i-=_+j;a-=k+z;this.group.attr("transform",m);this.walk(function(t){t._children=t._children||t.children||[];t.x0=t.x===undefined?i/2:t.x;t.y0=t.y===undefined?a/2:t.y},this.options.data,true);d.size([i,a]).children(r);y=d(this.options.data);h=this.group.selectAll(".line").data(d.links(y),function(t){return f(t.target)});g=h.enter();v=h.exit();h.each(function(t){t.target._treeOld=false;t.target._treeNew=false});v.each(function(t){t.target._treeOld=true});if(this.options.lineStyle==="curved"){p=n.svg.diagonal()}else if(this.options.lineStyle==="axisAligned"){p=function(e){var i=n.svg.line().interpolate("step-before").x(t.accessor({field:"x"})).y(t.accessor({field:"y"}));return i([e.source,e.target])}}else{t.fatalError("$.dendrogram()","illegal option for lineStyle: "+this.options.lineStyle)}g.append("path").attr("class","line tree").each(function(t){t.target._treeNew=true}).attr("d",function(t){var e=s(t.target),n={x:e.x0,y:e.y0};return p({source:n,target:n})}).style("stroke-opacity",1e-6).style("stroke",this.options.lineColor).style("stroke-width",this.options.lineWidth).style("fill","none");v=this._transition(v);v.attr("d",function(t){var e=l(t.target);return p({source:e,target:e})}).style("stroke-opacity",1e-6).remove();h=this._transition(h);h.attr("d",p).style("stroke-opacity",1).style("stroke",this.options.lineColor).style("stroke-width",this.options.lineWidth);m="";if(!w){m="rotate(90)"}h=this.group.selectAll(".label").data(y,f);g=h.enter();v=h.exit();g.append("text").attr("class","label tree").attr("dy",function(n,i){var o=e.options.labelPosition(n,i),r;if(o==="above"){r="-0.8em"}else if(o==="below"){r="1.35em"}else{t.fatalError("$.dendrogram()","Invalid labelPosition")}return r}).attr("transform",function(t){var e=s(t);return"translate("+e.x0+","+e.y0+")"+m}).attr("text-anchor","middle").attr("font-size",this.options.labelSize).style("fill-opacity",1e-6).text(this.options.label);v=this._transition(v);v.attr("transform",function(t){var e=l(t);return"translate("+e.x+","+e.y+")"+m}).style("fill-opacity",1e-6).attr("font-size",this.options.labelSize).text(this.options.label).remove();h=this._transition(h);h.attr("transform",function(t){return"translate("+t.x+","+t.y+")"+m}).attr("font-size",this.options.labelSize).style("fill-opacity",1).text(this.options.label);h=this.group.selectAll(".node").data(y,f);g=h.enter();v=h.exit();g.append("circle").attr("class","node tree").attr("cx",function(t){return s(t).x0}).attr("cy",function(t){return s(t).y0}).attr("r",this.options.nodeSize).style("fill",this.options.nodeColor).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("click",function(t){e.options.sinkNode={value:t};e.options.sourceNode={value:t};if(e.options.on.click.apply(this,arguments)){o.apply(this,arguments)}e._update()});v=this._transition(v);v.attr("cx",function(t){return l(t).x}).attr("cy",function(t){return l(t).y}).attr("r",this.options.nodeSize).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove();h.moveToFront();h=this._transition(h);h.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",this.options.nodeSize).style("fill-opacity",1).style("stroke-opacity",1).style("fill",this.options.nodeColor)}})})(window.tangelo,window.jQuery,window.d3);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){return}t.widget("tangelo.geodots",{options:{latitude:t.accessor({value:0}),longitude:t.accessor({value:0}),size:t.accessor({value:20}),color:t.accessor({value:0}),worldGeometry:null,data:null},_create:function(){var i=this,o=t.vegaspec.geovis(i.options.worldGeometry);this.options=e.extend(true,{},this._defaults,this.options);n.parse.spec(o,function(t){i.vis=t;i._update()})},_update:function(){var t=this;if(this.options.data){this.options.data.forEach(function(e){e.latitude=t.options.latitude(e);e.longitude=t.options.longitude(e);e.size=t.options.size(e);e.color=t.options.color(e)});if(this.vis){this.vis({el:t.element.get(0),data:{table:t.options.data,links:[]}}).update()}}}})})(window.tangelo,window.jQuery,window.vg);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){return}t.widget("tangelo.geonodelink",{options:{nodeLatitude:t.accessor({value:0}),nodeLongitude:t.accessor({value:0}),nodeSize:t.accessor({value:20}),nodeColor:t.accessor({value:0}),linkColor:t.accessor({value:0}),linkSource:t.accessor({value:0}),linkTarget:t.accessor({value:0}),data:null},_create:function(){var e=this,i=t.vegaspec.geovis(e.options.worldGeometry);n.parse.spec(i,function(t){e.vis=t;e._update()})},_update:function(){var t=this;e.each(this.options.data.nodes,function(e,n){var i=t.options.data.nodes[e];i.latitude=t.options.nodeLatitude(i);i.longitude=t.options.nodeLongitude(i);i.size=t.options.nodeSize(i);i.color=t.options.nodeColor(i)});e.each(this.options.data.links,function(e,n){var i=t.options.data.links[e];i.color=t.options.linkColor(i);i.source=t.options.linkSource(i);i.target=t.options.linkTarget(i)});if(t.vis){t.vis({el:this.element.get(0),data:{table:t.options.data.nodes,links:t.options.data.links}}).update()}}})})(window.tangelo,window.jQuery,window.vg);(function(t,e,n){"use strict";if(!(t&&e)){return}t.fn.girderBrowser=function(i){var o,r,a,s,l,c,u,d,p,f,h,g,v,y;i=i||{};s=i.caret===undefined?"true":i.caret;l=(i.label||"")+(s?"<b class=caret></b>":"");c=i.api||"/girder/api/v1";u=i.selectItem||t.noop;d=i.selectFolder||t.noop;p=i.selectSearchResult||t.noop;g=i.search;f=function(i,o){var r;y=i.append("li").append("a").text("Loading items...");r={folderId:o};e.json(c+"/item?"+t.param(r),function(e,o){var r;if(e){console.warn(e);n.fatalError("girderBrowser","could not retrieve items")}y.remove();if(o.length>0){t.each(o,function(t,e){r=i.append("li").append("a").attr("href","#").text(e.name+" ("+e.size+"B)");r.on("click",function(){u(e,c)})})}})};h=function(i,o,r){var a;i.append("li").append("a").text("Loading folders...");a={parentType:o,parentId:r};e.json(c+"/folder?"+t.param(a),function(e,o){var r;if(e){console.warn(e);n.fatalError("girderBrowser","could not retrieve folders")}t(i.node()).empty();t.each(o,function(t,e){r=i.append("li").classed("dropdown-submenu",true);r.append("a").attr("href","#").text(e.name).on("click",function(){d(e,c)});r=r.append("ul").classed("dropdown-menu",true);h(r,"folder",e._id);r.append("li").classed("divider",true);f(r,e._id)})})};t(this[0]).empty();o=e.select(this[0]);o.classed("dropdown",true);o.append("a").attr("href","#").attr("role","button").classed("dropdown-toggle",true).attr("data-toggle","dropdown").html(l);r=o.append("ul").classed("dropdown-menu",true);if(g){v=r.append("li").append("input").attr("type","text").attr("placeholder","Quick search...");v.on("click",function(){e.event.stopPropagation()}).on("keyup",function(){var i=null,o=null,a;a=function(o,r){var a;if(i){i.abort()}if(o.length===0){r.selectAll(".search-result").remove();return}a={q:o,types:JSON.stringify(["item"])};i=e.json([c,"resource","search"].join("/")+"?"+t.param(a),function(t,e){i=null;if(t){console.warn(t);n.fatalError("girderBrowser","could not perform search")}r.selectAll(".search-result").remove();if(e.item.length===0){r.append("li").classed("search-result",true).html("<em>No search results.</em>")}r.selectAll(".search-result").data(e.item).enter().append("li").classed("search-result",true).append("a").attr("href","#").text(function(t){return t.name}).on("click",function(t){p(t,c)})})};return function(){var t=e.select(this).property("value");window.clearTimeout(o);o=window.setTimeout(a,200,t,r)}}())}y=r.append("li").append("a").text("Loading...");e.json(c+"/user",function(i,o){if(i){console.warn(i);n.fatalError("girderBrowser","could not retrieve users")}y.remove();if(o.length>0){r.append("li").html("<strong>Users</strong>");t.each(o,function(t,e){a=r.append("li").classed("dropdown-submenu",true);a.append("a").attr("href","#").text([e.firstName,e.lastName].join(" "));a=a.append("ul").classed("dropdown-menu",true);h(a,"user",e._id)})}e.json(c+"/collection",function(e,i){if(e){console.warn(e);n.fatalError("girderBrowser","could not retrieve collections")}if(i.length>0){r.append("li").html("<strong>Collections</strong>");t.each(i,function(t,e){a=r.append("li").classed("dropdown-submenu",true);a.append("a").attr("href","#").text(e.name);a=a.append("ul").classed("dropdown-menu",true);h(a,"collection",e._id)})}})});t(o.select("a").node()).dropdown()}})(window.jQuery,window.d3,window.tangelo);(function(t,e,n,i){"use strict";if(!(e&&i&&i.widget&&n)){return}t.widget("tangelo.mapdots",{options:{hoverContent:t.accessor({value:""}),size:t.accessor({value:1}),color:t.accessor({value:""}),latitude:t.accessor({value:0}),longitude:t.accessor({value:0}),opacity:t.accessor({value:1}),data:null},_create:function(){var t=this.element.get(0),o=this;this.map=new e.maps.Map(t,{zoom:2,center:new e.maps.LatLng(0,0),mapTypeId:e.maps.MapTypeId.TERRAIN});n.select(t).style("width","100%").style("height","100%");i(t).resize(function(){e.maps.event.trigger(o.map,"resize")});this.overlay=new e.maps.OverlayView;this.overlay.onAdd=function(){o.layer=n.select(this.getPanes().overlayMouseTarget).append("div").style("position","absolute");o.colorScale=n.scale.category10();this.draw=function(){var t,e=o.transform(this.getProjection());t=o.layer.selectAll("svg").data(o.options.data).each(e);t.enter().append("svg").each(e).attr("class","marker").style("cursor","crosshair").style("position","absolute").append("circle");n.selectAll("svg > circle").data(o.options.data).attr("r",function(t){return o.sizeScale(o.options.size(t))}).attr("cx",function(t){return o.sizeScale(o.options.size(t))+2}).attr("cy",function(t){return o.sizeScale(o.options.size(t))+2}).style("fill",function(t){return o.colorScale(o.options.color(t))}).style("opacity",function(t){return o.options.opacity(t)}).each(function(t){var e,n=o.options.hoverContent(t);if(!n){return}e={html:true,container:"body",placement:"top",trigger:"hover",content:o.options.hoverContent(t),delay:{show:0,hide:0}};i(this).popover(e)});t.exit().remove()};this.onRemove=i.noop};this.overlay.setMap(this.map)},_update:function(){var t=this;this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data,this.options.size)).range([5,15]);this.transform=function(i){return function(o){var r=t.sizeScale(t.options.size(o));o=new e.maps.LatLng(t.options.latitude(o),t.options.longitude(o));o=i.fromLatLngToDivPixel(o);return n.select(this).style("left",o.x-r-2+"px").style("top",o.y-r-2+"px").style("width",2*r+4+"px").style("height",2*r+4+"px")}};if(this.overlay.draw){this.overlay.draw()}}})})(window.tangelo,window.google,window.d3,window.jQuery);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){return}t.widget("tangelo.nodelink",{options:{nodeCharge:t.accessor({value:-130}),nodeColor:t.accessor({value:"steelblue"}),nodeSize:t.accessor({value:10}),nodeLabel:t.accessor({value:""}),nodeOpacity:t.accessor({value:1}),nodeId:t.accessor({index:true}),linkSource:t.accessor({field:"source"}),linkTarget:t.accessor({field:"target"}),linkDistance:t.accessor({value:30}),linkOpacity:t.accessor({value:.2}),nodeX:t.accessor(),nodeY:t.accessor(),width:1e3,height:1e3,dynamicLabels:false,data:null},_create:function(){this.colorScale=n.scale.category10();this.force=n.layout.force();this.svg=n.select(this.element.get(0)).append("svg")},_update:function(){var t=this,e={};if(this.options.nodeX&&!this.options.nodeX.undefined){this.xScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeX)).range([50,this.options.width-100])}if(this.options.nodeY&&!this.options.nodeY.undefined){this.yScale=n.scale.linear().domain(n.extent(this.options.data.nodes,this.options.nodeY)).range([this.options.height-100,50])}this.force.linkDistance(this.options.linkDistance).charge(this.options.nodeCharge).size([this.options.width,this.options.height]);this.options.data.nodes.forEach(function(n,i){e[t.options.nodeId(n,i)]=n;n.degree=0;n.outgoing=[];n.incoming=[]});this.options.data.links.forEach(function(n,i){n.source=e[t.options.linkSource(n,i)];n.target=e[t.options.linkTarget(n,i)];n.source.degree+=1;n.target.degree+=1;n.source.outgoing.push(n.target);n.target.incoming.push(n.source)});this.options.data.nodes.sort(function(t,e){return n.descending(t.degree,e.degree)});this.sizeScale=n.scale.sqrt().domain(n.extent(this.options.data.nodes,t.options.nodeSize)).range([5,15]);this.force.size([this.options.width,this.options.height]).nodes(this.options.data.nodes).links(this.options.data.links).start();this.link=this.svg.selectAll(".link").data(this.options.data.links);this.link.enter().append("line").classed("link",true).style("opacity",this.options.linkOpacity).style("stroke","black").style("stroke-width",1);this.node=this.svg.selectAll(".node").data(this.options.data.nodes);this.node.enter().append("circle").classed("node",true).call(this.force.drag).append("title");this.node.attr("r",function(e,n){return t.sizeScale(t.options.nodeSize(e,n))}).style("fill",function(e,n){return t.colorScale(t.options.nodeColor(e,n))}).style("opacity",this.options.nodeOpacity);this.node.selectAll("title").text(this.options.nodeLabel);if(!t.options.dynamicLabels){this.label=this.svg.selectAll("text").data(this.options.data.nodes);this.label.enter().append("text").text(this.options.nodeLabel)}this.force.on("tick",function(){t._tick(t)});this.force.resume()},_tick:function(){var t=this,e;if(this.options.nodeX&&!t.options.nodeX.undefined){t.options.data.nodes.forEach(function(e,n){e.x=t.xScale(t.options.nodeX(e,n))})}if(this.options.nodeY&&!t.options.nodeY.undefined){t.options.data.nodes.forEach(function(e,n){e.y=t.yScale(t.options.nodeY(e,n))})}if(t.options.dynamicLabels){e=t._nodeLabels();t.svg.selectAll("text").remove();t.svg.selectAll("text").data(e).enter().append("text").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("font-size",function(t){return t.count+8}).text(function(t){return t.label})}else{t.label.attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}t.link.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y});t.node.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})},_nodeLabels:function(){var t=this,e=[];t.options.data.nodes.forEach(function(t){t.visited=false});t.options.data.nodes.forEach(function(n,i){var o=0,r=[],a;function s(e){if(e.visited){return}if(Math.abs(e.x-n.x)<50&&Math.abs(e.y-n.y)<50){o+=1;r.push(t.options.nodeLabel(e,i));e.visited=true;e.incoming.forEach(s);e.outgoing.forEach(s)}}s(n);if(o>1){a=t._reduceLabels(r);e.push({count:o,label:a,x:n.x,y:n.y})}});return e},_reduceLabels:function(t){var e="",n={},i,o,r;t.forEach(function(t){var e,i=n;e=t.split(" ");while(e.length>0){if(!i[e[0]]){i[e[0]]={count:0,next:{}}}i[e[0]].count+=1;i=i[e[0]].next;e=e.slice(1)}});while(true){o=0;r=0;for(i in n){if(n.hasOwnProperty(i)){if(n[i].count>o){o=n[i].count;r=i}}}if(o<2){break}e+=" "+r;n=n[r].next}return e}})})(window.tangelo,window.jQuery,window.d3);(function(t,e,n){"use strict";function i(t){t=t||{};var i=this,o=t.node,r=e.select(t.node).append("g"),a=r.append("rect").attr("class","axis").attr("x",0).attr("y",0).style("fill","none");this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height;this.data=t.data||[];this.idx=t.idx||undefined;this.radius=t.radius||"3pt";this.color=t.color||undefined;this.draw=function(){if(!(i.x&&i.y)){throw"x and y accessors are not set"}var s=t.padding||7.5,l=Math.max((i.width||n(o).width())-2*s,0),c=Math.max((i.height||n(o).height())-2*s,0),u=e.scale.linear().range([0,l]).domain([0,1]),d=e.scale.linear().range([c,0]).domain([0,1]),p=t.opacity||1,f=t.duration||0,h;
r.attr("transform","translate("+s+","+s+")");a.attr("width",l).attr("height",c);h=r.selectAll(".point").data(i.data,i.idx);h.enter().append("circle").attr("class","point").attr("cx",function(t){return u(i.x(t))}).attr("cy",function(t){return d(i.y(t))}).attr("r",i.radius).style({"fill-opacity":0,"stroke-opacity":0});h.exit().remove();if(f){h=h.transition().duration(f)}if(i.color){h.style("fill",i.color)}h.attr("cx",function(t){return u(i.x(t))}).attr("cy",function(t){return d(i.y(t))}).attr("r",i.radius).style({"fill-opacity":p,"stroke-opacity":p});return this}}function o(t){t=t||{};var o=this,r=t.node,a=e.select(r).append("svg").attr("class","correlationPlot"),s=a.append("g");this.variables=t.variables||[];this.data=t.data||[];this.width=t.width;this.height=t.height;this.plots={};this.draw=function(){if(!o.variables.length){return}var e=t.full,l=t.padding||10,c=15,u=o.width||n(r).width(),d=o.height||n(r).height(),p=Math.min(u,d),f=p-2*l-c,h=p-2*l-c,g=(u-p)/2,v=(d-p)/2,y=o.variables.length,w=y-(e?0:1),m=f/w,x=h/w,b,_=[],k,j;a.attr("width",u).attr("height",d);s.attr("transform","translate("+(l+g+c)+","+(l+v+c)+")");o.variables.forEach(function(t,e){o.variables.forEach(function(e,n){_.push({x:e,y:t,id:e.label+"-"+t.label})})});k=s.selectAll(".xlabel").data(o.variables.slice(0,w));k.enter().append("text").attr("class","xlabel").attr("text-anchor","middle");k.exit().remove();k.attr("x",function(t,e){return(e+.5)*m}).attr("y",-c/2).text(function(t){return t.label});j=s.selectAll(".ylabel").data(e?o.variables:o.variables.slice(1));j.enter().append("text").attr("class","ylabel").attr("x",0).attr("y",0).attr("text-anchor","middle");j.exit().remove();j.attr("transform",function(t,e){var n=-c/2,i=(w-e-.5)*m;return"translate("+n+","+i+") rotate(-90)"}).text(function(t){return t.label});b=s.selectAll(".subPlot").data(_,function(t){return t.id});b.enter().append("g").attr("class","subPlot").each(function(n,r){var a=r%y,s=y-1-Math.floor(r/y);if(e||a+s<y-1){o.plots[n.id]=new i({width:m,height:x,node:this,x:n.x,y:n.y,color:t.color})}else{o.plots[n.id]={draw:function(){return null}}}});b.exit().remove();b.attr("transform",function(t,e){var n=e%y,i=y-1-Math.floor(e/y);return"translate("+n*m+","+i*x+")"});b.each(function(t){var e=o.plots[t.id];e.width=m;e.height=x;e.data=o.data;e.draw()})}}if(!n||!n.widget){return}t.widget("tangelo.correlationPlot",{options:{variables:[],data:[],padding:10,color:t.accessor({value:"steelblue"}),full:false,width:null,height:null},_create:function(){this.obj=new o(n.extend({node:this.element.get(0)},this.options));this.element.on("draw",this.obj.draw)},_update:function(){n.extend(this.obj,this.options);this.obj.draw()},variables:function(t){this.obj.variables=t},data:function(t){this.obj.data=t}})})(window.tangelo,window.d3,window.jQuery);(function(t,e,n){"use strict";if(!(e&&e.widget&&n)){return}function i(t,e){if(e){t=t.transition(e)}return t}t.widget("tangelo.timeline",{options:{data:[],x:t.accessor({field:"time"}),y:t.accessor({field:"value"}),margin:{top:10,bottom:30,left:30,right:10},transition:0,width:null,height:null,xTicks:10,yTicks:10},_create:function(){this.svg=n.select(this.element.get(0)).append("svg").attr("class","timeline");this.main=this.svg.append("g");this.plot=this.main.append("g").attr("class","plot");this.xaxis=this.main.append("g").attr("class","x-axis axis");this.yaxis=this.main.append("g").attr("class","y-axis axis");this.path=this.plot.append("path").attr("class","path");this._x=null;this._y=null},_update:function(){var e=this,o=15,r=this.options.margin,a=t.accessor(this.options.x),s=t.accessor(this.options.y),l=(this.options.width||this.element.width())-r.left-r.right-o,c=(this.options.height||this.element.height())-r.top-r.bottom-o,u=this.options.data,d,p,f;this._x=n.time.scale().domain(n.extent(u,a)).range([0,l]).nice();this._y=n.scale.linear().domain(n.extent(u,s)).range([c,0]).nice();d=n.svg.axis().scale(this._x).orient("bottom");d.ticks(this.options.xTicks);p=n.svg.axis().scale(this._y).orient("left");p.ticks(this.options.yTicks);f=n.svg.line().x(function(t){return e._x(a(t))}).y(function(t){return e._y(s(t))});this.svg.attr("width",l+r.left+r.right+o).attr("height",c+r.top+r.bottom+o);this.main.attr("transform","translate("+(r.left+o)+","+r.top+")");i(this.xaxis,this.options.transition).attr("transform","translate(0,"+c+")").call(d);i(this.yaxis,this.options.transition).call(p);i(this.path,this.options.transition).attr("d",f(this.options.data))},xScale:function(){return this._x},yScale:function(){return this._y}})})(window.tangelo,window.jQuery,window.d3);(function(t,e,n,i){"use strict";if(!(i&&i.widget&&n&&e)){return}t.widget("tangelo.geojsMap",{options:{zoom:3,width:null,heigth:null},latlng2display:function(t){return this._map.gcsToDisplay(t)},display2latlng:function(t){return this._map.displayToGcs(t)},svg:function(){return this.svgGroup},legend:function(){throw"Legend layer not yet implemented"},map:function(){return this._map},_create:function(){var t=this.element.get(0),n={zoom:this.options.zoom,node:t},o=this;this._map=e.map(n);this._map.addLayer(e.osmLayer({renderer:"vglRenderer"}).referenceLayer(true));this.svgLayer=e.featureLayer({renderer:"d3Renderer"});this._map.addLayer(this.svgLayer);this.svgContext=this.svgLayer.renderer().canvas();this.svgGroup=this.svgContext.append("g").node();this._resize();i(window).resize(function(){o._resize()});this._map.on([e.event.pan,e.event.zoom],function(){i(t).trigger("draw")})},_update:i.noop,_resize:function(){var t=this.options.width||this.element.width(),e=this.options.height||this.element.height();if(!this._map){return}this._map.resize(0,0,t,e);this.element.trigger("draw")},_setOption:function(t,e){this.options[t]=e;if(t==="width"||t==="height"){this._resize()}this._update()}})})(window.tangelo,window.geo,window.d3,window.jQuery);(function(t,e,n,i){"use strict";if(!(e&&e.widget&&n&&i)){return}t.widget("tangelo.geojsdots",e.tangelo.geojsMap,{options:{latitude:t.accessor({value:0}),longitude:t.accessor({value:0}),size:t.accessor({value:20}),color:t.accessor({value:0}),data:null},_create:function(){var t=this;this.colorScale=n.scale.category10();this._super();this.element.on("draw",function(){t._update()})},_update:function(){var e=this.svg(),o=this,r=t.accessor(this.options.latitude),a=t.accessor(this.options.longitude),s,l,c,u;if(this.options.data&&this.map()){this.options.data.forEach(function(t){s=i.latlng(r(t),a(t));t._georef=o.latlng2display(s)[0]});l=n.select(e).selectAll(".point").data(this.options.data);c=l.enter();u=l.exit();c.append("circle").attr("class","point");l.attr("cx",t.accessor({field:"_georef.x"})).attr("cy",t.accessor({field:"_georef.y"})).attr("r",t.accessor(this.options.size)).style("fill",function(e){return o.colorScale(t.accessor(o.options.color)(e))});u.remove()}}})})(window.tangelo,window.jQuery,window.d3,window.geo);window.tangelo.stream={};(function(t,e){"use strict";t.stream.streams=function(t){e.ajax({url:"/stream",type:"GET",dataType:"json",error:function(e){t(undefined,e)},success:function(e){t(e)}})};t.stream.start=function(n,i){var o="/stream"+t.absoluteUrl(n);e.ajax({url:o,type:"POST",dataType:"json",error:function(t){var e={status:t.status,statusText:t.statusText,description:JSON.parse(t.responseText).error,jqxhr:t};i(undefined,e)},success:function(t){i(t.key)}})};t.stream.query=function(t,n){e.ajax({url:"/stream/"+t,dataType:"json",error:function(t){var e={status:t.status,statusText:t.statusText,description:JSON.parse(t.responseText).error,jqxhr:t};n(undefined,undefined,e)},success:function(t,e,i){if(i.status===204){n(undefined,true)}else{n(t,false)}}})};t.stream.run=function(e,n,i){if(i===undefined){i=100}t.stream.query(e,function(o,r,a){var s,l=true;if(a){console.warn("[tangelo.stream.run()] error during stream query");n(undefined,undefined,a);return}if(r){n(undefined,true)}else{s=n(o,false);if(s===undefined){if(t.isFunction(s)){n=s}else if(t.isBoolean(s)){l=s}else if(t.isNumber(s)){i=s}}if(l){window.setTimeout(t.stream.run,i,e,n,i)}}})};t.stream.delete=function(t,n){e.ajax({url:"/stream/"+t,dataType:"json",type:"DELETE",error:function(t){if(n){n(undefined,t)}},success:function(t){if(n){n(t)}}})}})(window.tangelo,window.$);window.tangelo.data={};(function(t){"use strict";t.data.tree=function(e){var n=t.accessor(e.id||{value:""}),i=t.accessor(e.idChild||{value:""}),o=t.accessor(e.children),r=e.data,a={},s;if(o.undefined){t.fatalError("tangelo.data.tree()","A 'children' accessor is required")}r.forEach(function(t){a[n(t)]=t});r.forEach(function(t){if(o(t)){t.children=[];o(t).forEach(function(e){var n=a[i(e)];n.hasParent=true;t.children.push(n)})}});r.forEach(function(t){if(!t.hasParent){s=t}delete t.hasParent});return s}})(window.tangelo);(function(t){"use strict";function e(t,e){return function(n,i){var o=t(n),r=e(n),a=t(i),s=e(i),l=o-a,c=r-s;return Math.sqrt(l*l+c*c)}}function n(){var e=[];e.center=function(){return e[0]};e.id=t.uniqueID();e.children=[];return e}function i(i){var o,r,a,s,l,c=[],u=[],d,p,f,h=[],g=[];i=i||{};o=i.x||t.accessor({field:"x"});r=i.y||t.accessor({field:"y"});a=i.metric||e(o,r);l=i.clusterDistance||20;s=i.data||[];if(l<0){return{singlets:s.slice(),clusters:[]}}for(d=0;d<s.length;d+=1){f=false;for(p=0;p<c.length;p+=1){u=c[p];if(a(s[d],u.center())<l){u.push(s[d]);f=true;break}}if(!f){u=n();u.push(s[d]);c.push(u)}}c.forEach(function(t){if(t.length===1){t[0].cluster=t;h.push(t[0])}else{t.forEach(function(e){e.cluster=t});g.push(t)}});return{singlets:h,clusters:g}}t.data.distanceCluster=i})(window.tangelo);(function(t){"use strict";var e={box:function(){return function t(){return 1}},gaussian:function(t){var e=t/3,n=1/(e*Math.sqrt(2*Math.PI)),i=e*e;return function(t,e){var o=t-e;return n*Math.exp(-.5*o*o/i)}}};t.data.smooth=function(n){var i=t.accessor(n.x||{field:"x"}),o=t.accessor(n.y||{field:"y"}),r=n.set,a=n.kernel||"box",s=n.radius!==undefined?n.radius:.05,l=n.absolute!==undefined?n.absolute:false,c=n.sorted!==undefined?n.sorted:true,u=n.normalize!==undefined?n.normalize:true,d=n.data||[],p=d.length,f,h,g,v,y,w,m,x,b,_=[],k=[];k.length=p;if(p===0){return[]}if(!c){d.sort(function(t,e){return i(t)-i(e)})}if(!l){b=i(d[p-1])-i(d[0]);if(b<0){t.fatalError("Unsorted input detected.  Try spec.sorted=false")}s=s*b}if(typeof a==="string"){a=e[a](s);if(!a){t.fatalError('Unknown kernel "'+a+'"')}}if(s<0){d.forEach(function(t,e){k[e]=o(t);if(r){r.call(d,o(t),t,e)}});return k}f=[];f.length=p;d.forEach(function(t,e){f[e]=o(t);_.push(0)});g=0;for(h=0;h<p;h+=1){y=i(d[h]);m=0;for(v=g;v<p;v+=1){w=i(d[v]);x=f[v];if(w>y+s){break}if(w<y-s){g=v+1}else{b=a.call(d,y,w,h,v);_[v]+=b;m+=b*x}}k[h]=m}for(h=0;h<p;h+=1){m=k[h];if(u){m=m/_[h];k[h]=m}if(r){r.call(d,m,d[h],h)}}return k}})(window.tangelo);